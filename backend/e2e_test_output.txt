============================= test session starts =============================
platform win32 -- Python 3.12.11, pytest-8.4.2, pluggy-1.6.0
rootdir: D:\Project\Running\VideTrading\Vibex\backend
configfile: pyproject.toml
plugins: anyio-4.11.0, asyncio-1.2.0, mock-3.15.1
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 17 items

tests\e2e\test_decision_generate_api_e2e.py .FFE.E.E.E.E.E.E.            [100%]

=================================== ERRORS ====================================
_ ERROR at setup of TestDecisionGenerateAPIWithAuth.test_valid_request_minimal_fields _
  + Exception Group Traceback (most recent call last):
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 183, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\logging.py", line 843, in pytest_runtest_setup
    |     yield
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\capture.py", line 895, in pytest_runtest_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 164, in pytest_runtest_setup
    |     item.session._setupstate.setup(item)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 514, in setup
    |     col.setup()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 463, in setup
    |     return super().setup()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\python.py", line 1674, in setup
    |     self._request._fillfixtures()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 720, in _fillfixtures
    |     item.funcargs[argname] = self.getfixturevalue(argname)
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 549, in getfixturevalue
    |     fixturedef = self._get_active_fixturedef(argname)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 640, in _get_active_fixturedef
    |     fixturedef.execute(request=subrequest)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1128, in execute
    |     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 748, in pytest_fixture_setup
    |     hook_result = yield
    |                   ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\setuponly.py", line 36, in pytest_fixture_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1196, in pytest_fixture_setup
    |     result = call_fixture_func(fixturefunc, request, kwargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 930, in call_fixture_func
    |     fixture_result = fixturefunc(**kwargs)
    |                      ^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 366, in _async_fixture_wrapper
    |     result = runner.run(setup(), context=context)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 691, in run_until_complete
    |     return future.result()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 362, in setup
    |     res = await fixture_function(*args, **kwargs)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    |     challenge_response = await async_client.post(
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    |     raise app_exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    |     challenge = await get_challenge(db, address)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    |     await db.commit()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    |     await greenlet_spawn(self.sync_session.commit)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    |     trans.commit(_to_root=True)
    |   File "<string>", line 2, in commit
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    |     self._prepare_impl()
    |   File "<string>", line 2, in _prepare_impl
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    |     self.session.flush()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    |     self._flush(objects)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    |     flush_context.execute()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    |     rec.execute(self)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    |     util.preloaded.orm_persistence.save_obj(
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    |     ) in _organize_states_for_save(base_mapper, states, uowtransaction):
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    |     for state, dict_, mapper, connection in _connections_for_states(
    |                                             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    |     connection = uowtransaction.transaction.connection(base_mapper)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in connection
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    |     return self._connection_for_bind(bind, execution_options)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    |     conn = self._parent._connection_for_bind(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    |     conn = bind.connect()
    |            ^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    |     return self._connection_cls(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    |     result = pool._dialect._do_ping_w_event(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    |     return self.do_ping(dbapi_connection)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    |     dbapi_connection.ping()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    |     self._handle_exception(error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    |     raise error
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    |     _ = self.await_(self._async_ping())
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    |     await tr.start()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg\\protocol\\protocol.pyx", line 375, in query
    |   File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
    |   File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
    |   File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    |     self._loop_writing(data=bytes(data))
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    |     self._write_fut = self._loop._proactor.send(self._sock, data)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^
    | AttributeError: 'NoneType' object has no attribute 'send'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    challenge_response = await async_client.post(
                         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    challenge = await get_challenge(db, address)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    await db.commit()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    ) in _organize_states_for_save(base_mapper, states, uowtransaction):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    for state, dict_, mapper, connection in _connections_for_states(
                                            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    connection = uowtransaction.transaction.connection(base_mapper)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in connection
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    return self._connection_for_bind(bind, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    conn = self._parent._connection_for_bind(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
           ^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    result = pool._dialect._do_ping_w_event(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    return self.do_ping(dbapi_connection)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    dbapi_connection.ping()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    self._handle_exception(error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    raise error
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    _ = self.await_(self._async_ping())
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    await tr.start()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
  File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
  File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
  File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    self._loop_writing(data=bytes(data))
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:
E   AttributeError: 'NoneType' object has no attribute 'send'
---------------------------- Captured stderr setup ----------------------------
{"timestamp": "2025-11-07T06:39:17.709040Z", "level": "ERROR", "logger": "sqlalchemy.pool.impl.AsyncAdaptedQueuePool", "message": "Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F41C5B110>>", "module": "base", "function": "_close_connection", "line": 376, "exception": "Traceback (most recent call last):\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 372, in _close_connection\n    self._dialect.do_terminate(connection)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 1127, in do_terminate\n    dbapi_connection.terminate()\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\connectors\\asyncio.py\", line 402, in terminate\n    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 912, in _terminate_graceful_close\n    await self._connection.close(timeout=2)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1504, in close\n    await self._protocol.close(timeout)\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 627, in close\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1673, in _cancel_current_command\n    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))\n                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 455, in create_task\n    self._check_closed()\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 545, in _check_closed\n    raise RuntimeError('Event loop is closed')\nRuntimeError: Event loop is closed"}
{"timestamp": "2025-11-07T06:39:17.714423Z", "level": "ERROR", "logger": "app.db.session", "message": "Database session error: 'NoneType' object has no attribute 'send'", "module": "session", "function": "get_db", "line": 124}
----------------------------- Captured log setup ------------------------------
ERROR    sqlalchemy.pool.impl.AsyncAdaptedQueuePool:base.py:376 Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F41C5B110>>
Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 372, in _close_connection
    self._dialect.do_terminate(connection)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1127, in do_terminate
    dbapi_connection.terminate()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 402, in terminate
    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 912, in _terminate_graceful_close
    await self._connection.close(timeout=2)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1504, in close
    await self._protocol.close(timeout)
  File "asyncpg\\protocol\\protocol.pyx", line 627, in close
  File "asyncpg\\protocol\\protocol.pyx", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1673, in _cancel_current_command
    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 455, in create_task
    self._check_closed()
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 545, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
ERROR    app.db.session:session.py:124 Database session error: 'NoneType' object has no attribute 'send'
_ ERROR at setup of TestDecisionGenerateAPIWithAuth.test_missing_required_fields _
  + Exception Group Traceback (most recent call last):
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 183, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\logging.py", line 843, in pytest_runtest_setup
    |     yield
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\capture.py", line 895, in pytest_runtest_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 164, in pytest_runtest_setup
    |     item.session._setupstate.setup(item)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 514, in setup
    |     col.setup()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 463, in setup
    |     return super().setup()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\python.py", line 1674, in setup
    |     self._request._fillfixtures()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 720, in _fillfixtures
    |     item.funcargs[argname] = self.getfixturevalue(argname)
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 549, in getfixturevalue
    |     fixturedef = self._get_active_fixturedef(argname)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 640, in _get_active_fixturedef
    |     fixturedef.execute(request=subrequest)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1128, in execute
    |     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 748, in pytest_fixture_setup
    |     hook_result = yield
    |                   ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\setuponly.py", line 36, in pytest_fixture_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1196, in pytest_fixture_setup
    |     result = call_fixture_func(fixturefunc, request, kwargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 930, in call_fixture_func
    |     fixture_result = fixturefunc(**kwargs)
    |                      ^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 366, in _async_fixture_wrapper
    |     result = runner.run(setup(), context=context)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 691, in run_until_complete
    |     return future.result()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 362, in setup
    |     res = await fixture_function(*args, **kwargs)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    |     challenge_response = await async_client.post(
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    |     raise app_exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    |     challenge = await get_challenge(db, address)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    |     await db.commit()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    |     await greenlet_spawn(self.sync_session.commit)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    |     trans.commit(_to_root=True)
    |   File "<string>", line 2, in commit
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    |     self._prepare_impl()
    |   File "<string>", line 2, in _prepare_impl
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    |     self.session.flush()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    |     self._flush(objects)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    |     flush_context.execute()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    |     rec.execute(self)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    |     util.preloaded.orm_persistence.save_obj(
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    |     ) in _organize_states_for_save(base_mapper, states, uowtransaction):
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    |     for state, dict_, mapper, connection in _connections_for_states(
    |                                             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    |     connection = uowtransaction.transaction.connection(base_mapper)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in connection
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    |     return self._connection_for_bind(bind, execution_options)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    |     conn = self._parent._connection_for_bind(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    |     conn = bind.connect()
    |            ^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    |     return self._connection_cls(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    |     result = pool._dialect._do_ping_w_event(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    |     return self.do_ping(dbapi_connection)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    |     dbapi_connection.ping()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    |     self._handle_exception(error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    |     raise error
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    |     _ = self.await_(self._async_ping())
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    |     await tr.start()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg\\protocol\\protocol.pyx", line 375, in query
    |   File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
    |   File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
    |   File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    |     self._loop_writing(data=bytes(data))
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    |     self._write_fut = self._loop._proactor.send(self._sock, data)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^
    | AttributeError: 'NoneType' object has no attribute 'send'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    challenge_response = await async_client.post(
                         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    challenge = await get_challenge(db, address)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    await db.commit()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    ) in _organize_states_for_save(base_mapper, states, uowtransaction):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    for state, dict_, mapper, connection in _connections_for_states(
                                            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    connection = uowtransaction.transaction.connection(base_mapper)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in connection
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    return self._connection_for_bind(bind, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    conn = self._parent._connection_for_bind(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
           ^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    result = pool._dialect._do_ping_w_event(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    return self.do_ping(dbapi_connection)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    dbapi_connection.ping()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    self._handle_exception(error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    raise error
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    _ = self.await_(self._async_ping())
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    await tr.start()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
  File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
  File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
  File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    self._loop_writing(data=bytes(data))
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:
E   AttributeError: 'NoneType' object has no attribute 'send'
---------------------------- Captured stderr setup ----------------------------
{"timestamp": "2025-11-07T06:39:17.825066Z", "level": "ERROR", "logger": "sqlalchemy.pool.impl.AsyncAdaptedQueuePool", "message": "Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F41C5AC60>>", "module": "base", "function": "_close_connection", "line": 376, "exception": "Traceback (most recent call last):\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 372, in _close_connection\n    self._dialect.do_terminate(connection)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 1127, in do_terminate\n    dbapi_connection.terminate()\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\connectors\\asyncio.py\", line 402, in terminate\n    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 912, in _terminate_graceful_close\n    await self._connection.close(timeout=2)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1504, in close\n    await self._protocol.close(timeout)\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 627, in close\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1673, in _cancel_current_command\n    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))\n                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 455, in create_task\n    self._check_closed()\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 545, in _check_closed\n    raise RuntimeError('Event loop is closed')\nRuntimeError: Event loop is closed"}
{"timestamp": "2025-11-07T06:39:17.825066Z", "level": "ERROR", "logger": "app.db.session", "message": "Database session error: 'NoneType' object has no attribute 'send'", "module": "session", "function": "get_db", "line": 124}
----------------------------- Captured log setup ------------------------------
ERROR    sqlalchemy.pool.impl.AsyncAdaptedQueuePool:base.py:376 Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F41C5AC60>>
Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 372, in _close_connection
    self._dialect.do_terminate(connection)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1127, in do_terminate
    dbapi_connection.terminate()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 402, in terminate
    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 912, in _terminate_graceful_close
    await self._connection.close(timeout=2)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1504, in close
    await self._protocol.close(timeout)
  File "asyncpg\\protocol\\protocol.pyx", line 627, in close
  File "asyncpg\\protocol\\protocol.pyx", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1673, in _cancel_current_command
    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 455, in create_task
    self._check_closed()
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 545, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
ERROR    app.db.session:session.py:124 Database session error: 'NoneType' object has no attribute 'send'
_ ERROR at setup of TestDecisionGenerateAPIWithAuth.test_generate_decision_btc _
  + Exception Group Traceback (most recent call last):
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 183, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\logging.py", line 843, in pytest_runtest_setup
    |     yield
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\capture.py", line 895, in pytest_runtest_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 164, in pytest_runtest_setup
    |     item.session._setupstate.setup(item)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 514, in setup
    |     col.setup()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 463, in setup
    |     return super().setup()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\python.py", line 1674, in setup
    |     self._request._fillfixtures()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 720, in _fillfixtures
    |     item.funcargs[argname] = self.getfixturevalue(argname)
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 549, in getfixturevalue
    |     fixturedef = self._get_active_fixturedef(argname)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 640, in _get_active_fixturedef
    |     fixturedef.execute(request=subrequest)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1128, in execute
    |     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 748, in pytest_fixture_setup
    |     hook_result = yield
    |                   ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\setuponly.py", line 36, in pytest_fixture_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1196, in pytest_fixture_setup
    |     result = call_fixture_func(fixturefunc, request, kwargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 930, in call_fixture_func
    |     fixture_result = fixturefunc(**kwargs)
    |                      ^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 366, in _async_fixture_wrapper
    |     result = runner.run(setup(), context=context)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 691, in run_until_complete
    |     return future.result()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 362, in setup
    |     res = await fixture_function(*args, **kwargs)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    |     challenge_response = await async_client.post(
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    |     raise app_exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    |     challenge = await get_challenge(db, address)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    |     await db.commit()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    |     await greenlet_spawn(self.sync_session.commit)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    |     trans.commit(_to_root=True)
    |   File "<string>", line 2, in commit
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    |     self._prepare_impl()
    |   File "<string>", line 2, in _prepare_impl
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    |     self.session.flush()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    |     self._flush(objects)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    |     flush_context.execute()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    |     rec.execute(self)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    |     util.preloaded.orm_persistence.save_obj(
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    |     ) in _organize_states_for_save(base_mapper, states, uowtransaction):
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    |     for state, dict_, mapper, connection in _connections_for_states(
    |                                             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    |     connection = uowtransaction.transaction.connection(base_mapper)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in connection
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    |     return self._connection_for_bind(bind, execution_options)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    |     conn = self._parent._connection_for_bind(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    |     conn = bind.connect()
    |            ^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    |     return self._connection_cls(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    |     result = pool._dialect._do_ping_w_event(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    |     return self.do_ping(dbapi_connection)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    |     dbapi_connection.ping()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    |     self._handle_exception(error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    |     raise error
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    |     _ = self.await_(self._async_ping())
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    |     await tr.start()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg\\protocol\\protocol.pyx", line 375, in query
    |   File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
    |   File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
    |   File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    |     self._loop_writing(data=bytes(data))
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    |     self._write_fut = self._loop._proactor.send(self._sock, data)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^
    | AttributeError: 'NoneType' object has no attribute 'send'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    challenge_response = await async_client.post(
                         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    challenge = await get_challenge(db, address)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    await db.commit()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    ) in _organize_states_for_save(base_mapper, states, uowtransaction):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    for state, dict_, mapper, connection in _connections_for_states(
                                            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    connection = uowtransaction.transaction.connection(base_mapper)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in connection
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    return self._connection_for_bind(bind, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    conn = self._parent._connection_for_bind(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
           ^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    result = pool._dialect._do_ping_w_event(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    return self.do_ping(dbapi_connection)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    dbapi_connection.ping()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    self._handle_exception(error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    raise error
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    _ = self.await_(self._async_ping())
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    await tr.start()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
  File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
  File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
  File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    self._loop_writing(data=bytes(data))
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:
E   AttributeError: 'NoneType' object has no attribute 'send'
---------------------------- Captured stderr setup ----------------------------
{"timestamp": "2025-11-07T06:39:17.914641Z", "level": "ERROR", "logger": "sqlalchemy.pool.impl.AsyncAdaptedQueuePool", "message": "Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F424F6E40>>", "module": "base", "function": "_close_connection", "line": 376, "exception": "Traceback (most recent call last):\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 372, in _close_connection\n    self._dialect.do_terminate(connection)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 1127, in do_terminate\n    dbapi_connection.terminate()\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\connectors\\asyncio.py\", line 402, in terminate\n    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 912, in _terminate_graceful_close\n    await self._connection.close(timeout=2)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1504, in close\n    await self._protocol.close(timeout)\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 627, in close\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1673, in _cancel_current_command\n    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))\n                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 455, in create_task\n    self._check_closed()\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 545, in _check_closed\n    raise RuntimeError('Event loop is closed')\nRuntimeError: Event loop is closed"}
{"timestamp": "2025-11-07T06:39:17.914641Z", "level": "ERROR", "logger": "app.db.session", "message": "Database session error: 'NoneType' object has no attribute 'send'", "module": "session", "function": "get_db", "line": 124}
----------------------------- Captured log setup ------------------------------
ERROR    sqlalchemy.pool.impl.AsyncAdaptedQueuePool:base.py:376 Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F424F6E40>>
Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 372, in _close_connection
    self._dialect.do_terminate(connection)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1127, in do_terminate
    dbapi_connection.terminate()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 402, in terminate
    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 912, in _terminate_graceful_close
    await self._connection.close(timeout=2)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1504, in close
    await self._protocol.close(timeout)
  File "asyncpg\\protocol\\protocol.pyx", line 627, in close
  File "asyncpg\\protocol\\protocol.pyx", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1673, in _cancel_current_command
    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 455, in create_task
    self._check_closed()
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 545, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
ERROR    app.db.session:session.py:124 Database session error: 'NoneType' object has no attribute 'send'
__ ERROR at setup of TestDecisionGenerateAPIWithAuth.test_strategy_override ___
  + Exception Group Traceback (most recent call last):
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 183, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\logging.py", line 843, in pytest_runtest_setup
    |     yield
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\capture.py", line 895, in pytest_runtest_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 164, in pytest_runtest_setup
    |     item.session._setupstate.setup(item)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 514, in setup
    |     col.setup()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 463, in setup
    |     return super().setup()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\python.py", line 1674, in setup
    |     self._request._fillfixtures()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 720, in _fillfixtures
    |     item.funcargs[argname] = self.getfixturevalue(argname)
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 549, in getfixturevalue
    |     fixturedef = self._get_active_fixturedef(argname)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 640, in _get_active_fixturedef
    |     fixturedef.execute(request=subrequest)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1128, in execute
    |     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 748, in pytest_fixture_setup
    |     hook_result = yield
    |                   ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\setuponly.py", line 36, in pytest_fixture_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1196, in pytest_fixture_setup
    |     result = call_fixture_func(fixturefunc, request, kwargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 930, in call_fixture_func
    |     fixture_result = fixturefunc(**kwargs)
    |                      ^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 366, in _async_fixture_wrapper
    |     result = runner.run(setup(), context=context)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 691, in run_until_complete
    |     return future.result()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 362, in setup
    |     res = await fixture_function(*args, **kwargs)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    |     challenge_response = await async_client.post(
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    |     raise app_exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    |     challenge = await get_challenge(db, address)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    |     await db.commit()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    |     await greenlet_spawn(self.sync_session.commit)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    |     trans.commit(_to_root=True)
    |   File "<string>", line 2, in commit
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    |     self._prepare_impl()
    |   File "<string>", line 2, in _prepare_impl
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    |     self.session.flush()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    |     self._flush(objects)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    |     flush_context.execute()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    |     rec.execute(self)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    |     util.preloaded.orm_persistence.save_obj(
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    |     ) in _organize_states_for_save(base_mapper, states, uowtransaction):
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    |     for state, dict_, mapper, connection in _connections_for_states(
    |                                             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    |     connection = uowtransaction.transaction.connection(base_mapper)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in connection
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    |     return self._connection_for_bind(bind, execution_options)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    |     conn = self._parent._connection_for_bind(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    |     conn = bind.connect()
    |            ^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    |     return self._connection_cls(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    |     result = pool._dialect._do_ping_w_event(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    |     return self.do_ping(dbapi_connection)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    |     dbapi_connection.ping()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    |     self._handle_exception(error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    |     raise error
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    |     _ = self.await_(self._async_ping())
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    |     await tr.start()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg\\protocol\\protocol.pyx", line 375, in query
    |   File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
    |   File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
    |   File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    |     self._loop_writing(data=bytes(data))
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    |     self._write_fut = self._loop._proactor.send(self._sock, data)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^
    | AttributeError: 'NoneType' object has no attribute 'send'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    challenge_response = await async_client.post(
                         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    challenge = await get_challenge(db, address)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    await db.commit()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    ) in _organize_states_for_save(base_mapper, states, uowtransaction):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    for state, dict_, mapper, connection in _connections_for_states(
                                            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    connection = uowtransaction.transaction.connection(base_mapper)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in connection
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    return self._connection_for_bind(bind, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    conn = self._parent._connection_for_bind(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
           ^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    result = pool._dialect._do_ping_w_event(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    return self.do_ping(dbapi_connection)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    dbapi_connection.ping()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    self._handle_exception(error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    raise error
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    _ = self.await_(self._async_ping())
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    await tr.start()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
  File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
  File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
  File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    self._loop_writing(data=bytes(data))
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:
E   AttributeError: 'NoneType' object has no attribute 'send'
---------------------------- Captured stderr setup ----------------------------
{"timestamp": "2025-11-07T06:39:18.007441Z", "level": "ERROR", "logger": "sqlalchemy.pool.impl.AsyncAdaptedQueuePool", "message": "Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F42526D50>>", "module": "base", "function": "_close_connection", "line": 376, "exception": "Traceback (most recent call last):\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 372, in _close_connection\n    self._dialect.do_terminate(connection)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 1127, in do_terminate\n    dbapi_connection.terminate()\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\connectors\\asyncio.py\", line 402, in terminate\n    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 912, in _terminate_graceful_close\n    await self._connection.close(timeout=2)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1504, in close\n    await self._protocol.close(timeout)\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 627, in close\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1673, in _cancel_current_command\n    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))\n                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 455, in create_task\n    self._check_closed()\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 545, in _check_closed\n    raise RuntimeError('Event loop is closed')\nRuntimeError: Event loop is closed"}
{"timestamp": "2025-11-07T06:39:18.008443Z", "level": "ERROR", "logger": "app.db.session", "message": "Database session error: 'NoneType' object has no attribute 'send'", "module": "session", "function": "get_db", "line": 124}
----------------------------- Captured log setup ------------------------------
ERROR    sqlalchemy.pool.impl.AsyncAdaptedQueuePool:base.py:376 Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F42526D50>>
Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 372, in _close_connection
    self._dialect.do_terminate(connection)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1127, in do_terminate
    dbapi_connection.terminate()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 402, in terminate
    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 912, in _terminate_graceful_close
    await self._connection.close(timeout=2)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1504, in close
    await self._protocol.close(timeout)
  File "asyncpg\\protocol\\protocol.pyx", line 627, in close
  File "asyncpg\\protocol\\protocol.pyx", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1673, in _cancel_current_command
    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 455, in create_task
    self._check_closed()
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 545, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
ERROR    app.db.session:session.py:124 Database session error: 'NoneType' object has no attribute 'send'
_ ERROR at setup of TestDecisionGenerateAPIWithAuth.test_rate_limit_exceeded __
  + Exception Group Traceback (most recent call last):
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 183, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\logging.py", line 843, in pytest_runtest_setup
    |     yield
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\capture.py", line 895, in pytest_runtest_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 164, in pytest_runtest_setup
    |     item.session._setupstate.setup(item)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 514, in setup
    |     col.setup()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 463, in setup
    |     return super().setup()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\python.py", line 1674, in setup
    |     self._request._fillfixtures()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 720, in _fillfixtures
    |     item.funcargs[argname] = self.getfixturevalue(argname)
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 549, in getfixturevalue
    |     fixturedef = self._get_active_fixturedef(argname)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 640, in _get_active_fixturedef
    |     fixturedef.execute(request=subrequest)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1128, in execute
    |     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 748, in pytest_fixture_setup
    |     hook_result = yield
    |                   ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\setuponly.py", line 36, in pytest_fixture_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1196, in pytest_fixture_setup
    |     result = call_fixture_func(fixturefunc, request, kwargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 930, in call_fixture_func
    |     fixture_result = fixturefunc(**kwargs)
    |                      ^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 366, in _async_fixture_wrapper
    |     result = runner.run(setup(), context=context)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 691, in run_until_complete
    |     return future.result()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 362, in setup
    |     res = await fixture_function(*args, **kwargs)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    |     challenge_response = await async_client.post(
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    |     raise app_exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    |     challenge = await get_challenge(db, address)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    |     await db.commit()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    |     await greenlet_spawn(self.sync_session.commit)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    |     trans.commit(_to_root=True)
    |   File "<string>", line 2, in commit
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    |     self._prepare_impl()
    |   File "<string>", line 2, in _prepare_impl
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    |     self.session.flush()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    |     self._flush(objects)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    |     flush_context.execute()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    |     rec.execute(self)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    |     util.preloaded.orm_persistence.save_obj(
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    |     ) in _organize_states_for_save(base_mapper, states, uowtransaction):
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    |     for state, dict_, mapper, connection in _connections_for_states(
    |                                             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    |     connection = uowtransaction.transaction.connection(base_mapper)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in connection
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    |     return self._connection_for_bind(bind, execution_options)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    |     conn = self._parent._connection_for_bind(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    |     conn = bind.connect()
    |            ^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    |     return self._connection_cls(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    |     result = pool._dialect._do_ping_w_event(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    |     return self.do_ping(dbapi_connection)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    |     dbapi_connection.ping()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    |     self._handle_exception(error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    |     raise error
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    |     _ = self.await_(self._async_ping())
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    |     await tr.start()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg\\protocol\\protocol.pyx", line 375, in query
    |   File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
    |   File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
    |   File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    |     self._loop_writing(data=bytes(data))
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    |     self._write_fut = self._loop._proactor.send(self._sock, data)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^
    | AttributeError: 'NoneType' object has no attribute 'send'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    challenge_response = await async_client.post(
                         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    challenge = await get_challenge(db, address)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    await db.commit()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    ) in _organize_states_for_save(base_mapper, states, uowtransaction):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    for state, dict_, mapper, connection in _connections_for_states(
                                            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    connection = uowtransaction.transaction.connection(base_mapper)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in connection
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    return self._connection_for_bind(bind, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    conn = self._parent._connection_for_bind(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
           ^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    result = pool._dialect._do_ping_w_event(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    return self.do_ping(dbapi_connection)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    dbapi_connection.ping()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    self._handle_exception(error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    raise error
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    _ = self.await_(self._async_ping())
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    await tr.start()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
  File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
  File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
  File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    self._loop_writing(data=bytes(data))
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:
E   AttributeError: 'NoneType' object has no attribute 'send'
---------------------------- Captured stderr setup ----------------------------
{"timestamp": "2025-11-07T06:39:18.102926Z", "level": "ERROR", "logger": "sqlalchemy.pool.impl.AsyncAdaptedQueuePool", "message": "Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F425732F0>>", "module": "base", "function": "_close_connection", "line": 376, "exception": "Traceback (most recent call last):\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 372, in _close_connection\n    self._dialect.do_terminate(connection)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 1127, in do_terminate\n    dbapi_connection.terminate()\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\connectors\\asyncio.py\", line 402, in terminate\n    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 912, in _terminate_graceful_close\n    await self._connection.close(timeout=2)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1504, in close\n    await self._protocol.close(timeout)\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 627, in close\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1673, in _cancel_current_command\n    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))\n                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 455, in create_task\n    self._check_closed()\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 545, in _check_closed\n    raise RuntimeError('Event loop is closed')\nRuntimeError: Event loop is closed"}
{"timestamp": "2025-11-07T06:39:18.102926Z", "level": "ERROR", "logger": "app.db.session", "message": "Database session error: 'NoneType' object has no attribute 'send'", "module": "session", "function": "get_db", "line": 124}
----------------------------- Captured log setup ------------------------------
ERROR    sqlalchemy.pool.impl.AsyncAdaptedQueuePool:base.py:376 Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F425732F0>>
Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 372, in _close_connection
    self._dialect.do_terminate(connection)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1127, in do_terminate
    dbapi_connection.terminate()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 402, in terminate
    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 912, in _terminate_graceful_close
    await self._connection.close(timeout=2)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1504, in close
    await self._protocol.close(timeout)
  File "asyncpg\\protocol\\protocol.pyx", line 627, in close
  File "asyncpg\\protocol\\protocol.pyx", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1673, in _cancel_current_command
    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 455, in create_task
    self._check_closed()
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 545, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
ERROR    app.db.session:session.py:124 Database session error: 'NoneType' object has no attribute 'send'
_ ERROR at setup of TestDecisionGenerateAPIWithAuth.test_internal_server_error _
  + Exception Group Traceback (most recent call last):
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 183, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\logging.py", line 843, in pytest_runtest_setup
    |     yield
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\capture.py", line 895, in pytest_runtest_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 164, in pytest_runtest_setup
    |     item.session._setupstate.setup(item)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 514, in setup
    |     col.setup()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 463, in setup
    |     return super().setup()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\python.py", line 1674, in setup
    |     self._request._fillfixtures()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 720, in _fillfixtures
    |     item.funcargs[argname] = self.getfixturevalue(argname)
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 549, in getfixturevalue
    |     fixturedef = self._get_active_fixturedef(argname)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 640, in _get_active_fixturedef
    |     fixturedef.execute(request=subrequest)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1128, in execute
    |     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 748, in pytest_fixture_setup
    |     hook_result = yield
    |                   ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\setuponly.py", line 36, in pytest_fixture_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1196, in pytest_fixture_setup
    |     result = call_fixture_func(fixturefunc, request, kwargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 930, in call_fixture_func
    |     fixture_result = fixturefunc(**kwargs)
    |                      ^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 366, in _async_fixture_wrapper
    |     result = runner.run(setup(), context=context)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 691, in run_until_complete
    |     return future.result()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 362, in setup
    |     res = await fixture_function(*args, **kwargs)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    |     challenge_response = await async_client.post(
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    |     raise app_exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    |     challenge = await get_challenge(db, address)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    |     await db.commit()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    |     await greenlet_spawn(self.sync_session.commit)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    |     trans.commit(_to_root=True)
    |   File "<string>", line 2, in commit
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    |     self._prepare_impl()
    |   File "<string>", line 2, in _prepare_impl
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    |     self.session.flush()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    |     self._flush(objects)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    |     flush_context.execute()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    |     rec.execute(self)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    |     util.preloaded.orm_persistence.save_obj(
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    |     ) in _organize_states_for_save(base_mapper, states, uowtransaction):
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    |     for state, dict_, mapper, connection in _connections_for_states(
    |                                             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    |     connection = uowtransaction.transaction.connection(base_mapper)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in connection
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    |     return self._connection_for_bind(bind, execution_options)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    |     conn = self._parent._connection_for_bind(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    |     conn = bind.connect()
    |            ^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    |     return self._connection_cls(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    |     result = pool._dialect._do_ping_w_event(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    |     return self.do_ping(dbapi_connection)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    |     dbapi_connection.ping()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    |     self._handle_exception(error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    |     raise error
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    |     _ = self.await_(self._async_ping())
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    |     await tr.start()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg\\protocol\\protocol.pyx", line 375, in query
    |   File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
    |   File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
    |   File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    |     self._loop_writing(data=bytes(data))
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    |     self._write_fut = self._loop._proactor.send(self._sock, data)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^
    | AttributeError: 'NoneType' object has no attribute 'send'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    challenge_response = await async_client.post(
                         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    challenge = await get_challenge(db, address)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    await db.commit()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    ) in _organize_states_for_save(base_mapper, states, uowtransaction):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    for state, dict_, mapper, connection in _connections_for_states(
                                            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    connection = uowtransaction.transaction.connection(base_mapper)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in connection
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    return self._connection_for_bind(bind, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    conn = self._parent._connection_for_bind(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
           ^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    result = pool._dialect._do_ping_w_event(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    return self.do_ping(dbapi_connection)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    dbapi_connection.ping()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    self._handle_exception(error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    raise error
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    _ = self.await_(self._async_ping())
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    await tr.start()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
  File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
  File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
  File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    self._loop_writing(data=bytes(data))
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:
E   AttributeError: 'NoneType' object has no attribute 'send'
---------------------------- Captured stderr setup ----------------------------
{"timestamp": "2025-11-07T06:39:18.191725Z", "level": "ERROR", "logger": "sqlalchemy.pool.impl.AsyncAdaptedQueuePool", "message": "Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F424F64E0>>", "module": "base", "function": "_close_connection", "line": 376, "exception": "Traceback (most recent call last):\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 372, in _close_connection\n    self._dialect.do_terminate(connection)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 1127, in do_terminate\n    dbapi_connection.terminate()\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\connectors\\asyncio.py\", line 402, in terminate\n    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 912, in _terminate_graceful_close\n    await self._connection.close(timeout=2)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1504, in close\n    await self._protocol.close(timeout)\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 627, in close\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1673, in _cancel_current_command\n    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))\n                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 455, in create_task\n    self._check_closed()\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 545, in _check_closed\n    raise RuntimeError('Event loop is closed')\nRuntimeError: Event loop is closed"}
{"timestamp": "2025-11-07T06:39:18.191725Z", "level": "ERROR", "logger": "app.db.session", "message": "Database session error: 'NoneType' object has no attribute 'send'", "module": "session", "function": "get_db", "line": 124}
----------------------------- Captured log setup ------------------------------
ERROR    sqlalchemy.pool.impl.AsyncAdaptedQueuePool:base.py:376 Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F424F64E0>>
Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 372, in _close_connection
    self._dialect.do_terminate(connection)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1127, in do_terminate
    dbapi_connection.terminate()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 402, in terminate
    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 912, in _terminate_graceful_close
    await self._connection.close(timeout=2)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1504, in close
    await self._protocol.close(timeout)
  File "asyncpg\\protocol\\protocol.pyx", line 627, in close
  File "asyncpg\\protocol\\protocol.pyx", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1673, in _cancel_current_command
    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 455, in create_task
    self._check_closed()
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 545, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
ERROR    app.db.session:session.py:124 Database session error: 'NoneType' object has no attribute 'send'
_ ERROR at setup of TestDecisionGenerateAPIWithAuth.test_decision_object_validation _
  + Exception Group Traceback (most recent call last):
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 79, in collapse_excgroups
  |     yield
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 183, in __call__
  |     async with anyio.create_task_group() as task_group:
  |                ^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 781, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Traceback (most recent call last):
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 344, in from_call
    |     result: TResult | None = func()
    |                              ^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 246, in <lambda>
    |     lambda: runtest_hook(item=item, **kwds), when=when, reraise=reraise
    |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\logging.py", line 843, in pytest_runtest_setup
    |     yield
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\capture.py", line 895, in pytest_runtest_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 164, in pytest_runtest_setup
    |     item.session._setupstate.setup(item)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\runner.py", line 514, in setup
    |     col.setup()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 463, in setup
    |     return super().setup()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\python.py", line 1674, in setup
    |     self._request._fillfixtures()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 720, in _fillfixtures
    |     item.funcargs[argname] = self.getfixturevalue(argname)
    |                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 549, in getfixturevalue
    |     fixturedef = self._get_active_fixturedef(argname)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 640, in _get_active_fixturedef
    |     fixturedef.execute(request=subrequest)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1128, in execute
    |     result = ihook.pytest_fixture_setup(fixturedef=self, request=request)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_hooks.py", line 512, in __call__
    |     return self._hookexec(self.name, self._hookimpls.copy(), kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_manager.py", line 120, in _hookexec
    |     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 167, in _multicall
    |     raise exception
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 748, in pytest_fixture_setup
    |     hook_result = yield
    |                   ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 53, in run_old_style_hookwrapper
    |     return result.get_result()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_result.py", line 103, in get_result
    |     raise exc.with_traceback(tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 38, in run_old_style_hookwrapper
    |     res = yield
    |           ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 139, in _multicall
    |     teardown.throw(exception)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\setuponly.py", line 36, in pytest_fixture_setup
    |     return (yield)
    |             ^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pluggy\_callers.py", line 121, in _multicall
    |     res = hook_impl.function(*args)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 1196, in pytest_fixture_setup
    |     result = call_fixture_func(fixturefunc, request, kwargs)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\_pytest\fixtures.py", line 930, in call_fixture_func
    |     fixture_result = fixturefunc(**kwargs)
    |                      ^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 366, in _async_fixture_wrapper
    |     result = runner.run(setup(), context=context)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\runners.py", line 118, in run
    |     return self._loop.run_until_complete(task)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 691, in run_until_complete
    |     return future.result()
    |            ^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\pytest_asyncio\plugin.py", line 362, in setup
    |     res = await fixture_function(*args, **kwargs)
    |           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    |     challenge_response = await async_client.post(
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    |     return await self.request(
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    |     return await self.send(request, auth=auth, follow_redirects=follow_redirects)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    |     response = await self._send_handling_auth(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    |     response = await self._send_handling_redirects(
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    |     response = await self._send_single_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    |     response = await transport.handle_async_request(request)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    |     await super().__call__(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    |     await self.app(scope, receive, _send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    |     with recv_stream, send_stream, collapse_excgroups():
    |                                    ^^^^^^^^^^^^^^^^^^^^
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    |     self.gen.throw(value)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    |     response = await self.dispatch_func(request, call_next)
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    |     return await call_next(request)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    |     raise app_exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    |     await self.app(scope, receive_or_disconnect, send_no_error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    |     await self.middleware_stack(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    |     await route.handle(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    |     await self.app(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    |     raise exc
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    |     await app(scope, receive, sender)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    |     response = await f(request)
    |                ^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    |     raw_response = await run_endpoint_function(
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    |     return await dependant.call(**values)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    |     challenge = await get_challenge(db, address)
    |                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    |     await db.commit()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    |     await greenlet_spawn(self.sync_session.commit)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    |     result = context.throw(*sys.exc_info())
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    |     trans.commit(_to_root=True)
    |   File "<string>", line 2, in commit
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    |     self._prepare_impl()
    |   File "<string>", line 2, in _prepare_impl
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    |     self.session.flush()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    |     self._flush(objects)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    |     flush_context.execute()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    |     rec.execute(self)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    |     util.preloaded.orm_persistence.save_obj(
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    |     ) in _organize_states_for_save(base_mapper, states, uowtransaction):
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    |     for state, dict_, mapper, connection in _connections_for_states(
    |                                             ^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    |     connection = uowtransaction.transaction.connection(base_mapper)
    |                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in connection
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    |     return self._connection_for_bind(bind, execution_options)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    |     conn = self._parent._connection_for_bind(
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "<string>", line 2, in _connection_for_bind
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    |     ret_value = fn(self, *arg, **kw)
    |                 ^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    |     conn = bind.connect()
    |            ^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    |     return self._connection_cls(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    |     self._dbapi_connection = engine.raw_connection()
    |                              ^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    |     return self.pool.connect()
    |            ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    |     return _ConnectionFairy._checkout(self)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    |     with util.safe_reraise():
    |          ^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    |     raise exc_value.with_traceback(exc_tb)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    |     result = pool._dialect._do_ping_w_event(
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    |     return self.do_ping(dbapi_connection)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    |     dbapi_connection.ping()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    |     self._handle_exception(error)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    |     raise error
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    |     _ = self.await_(self._async_ping())
    |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    |     return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    |     value = await result
    |             ^^^^^^^^^^^^
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    |     await tr.start()
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    |     await self._connection.execute(query)
    |   File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    |     result = await self._protocol.query(query, timeout)
    |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "asyncpg\\protocol\\protocol.pyx", line 375, in query
    |   File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
    |   File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
    |   File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    |     self._loop_writing(data=bytes(data))
    |   File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    |     self._write_fut = self._loop._proactor.send(self._sock, data)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^
    | AttributeError: 'NoneType' object has no attribute 'send'
    +------------------------------------

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py", line 85, in authenticated_client
    challenge_response = await async_client.post(
                         ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1859, in post
    return await self.request(
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1540, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1629, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1657, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1694, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_client.py", line 1730, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\httpx\_transports\asgi.py", line 170, in handle_async_request
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\applications.py", line 1134, in __call__
    await super().__call__(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 186, in __call__
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
                                   ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_utils.py", line 85, in collapse_excgroups
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\middleware.py", line 22, in dispatch
    return await call_next(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\middleware\asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 124, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 110, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 390, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\fastapi\routing.py", line 289, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\api\routes\auth.py", line 17, in request_challenge
    challenge = await get_challenge(db, address)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\src\app\services\auth_service.py", line 19, in get_challenge
    await db.commit()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 1000, in commit
    await greenlet_spawn(self.sync_session.commit)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2030, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1311, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1286, in _prepare_impl
    self.session.flush()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4331, in flush
    self._flush(objects)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4466, in _flush
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4427, in _flush
    flush_context.execute()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 68, in save_obj
    ) in _organize_states_for_save(base_mapper, states, uowtransaction):
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 223, in _organize_states_for_save
    for state, dict_, mapper, connection in _connections_for_states(
                                            ^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1759, in _connections_for_states
    connection = uowtransaction.transaction.connection(base_mapper)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in connection
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1037, in connection
    return self._connection_for_bind(bind, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1173, in _connection_for_bind
    conn = self._parent._connection_for_bind(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1187, in _connection_for_bind
    conn = bind.connect()
           ^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3277, in connect
    return self._connection_cls(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3301, in raw_connection
    return self.pool.connect()
           ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1363, in _checkout
    with util.safe_reraise():
         ^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1301, in _checkout
    result = pool._dialect._do_ping_w_event(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 728, in _do_ping_w_event
    return self.do_ping(dbapi_connection)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1160, in do_ping
    dbapi_connection.ping()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 818, in ping
    self._handle_exception(error)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 799, in _handle_exception
    raise error
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 816, in ping
    _ = self.await_(self._async_ping())
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 825, in _async_ping
    await tr.start()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\transaction.py", line 146, in start
    await self._connection.execute(query)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 349, in execute
    result = await self._protocol.query(query, timeout)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "asyncpg\\protocol\\protocol.pyx", line 375, in query
  File "asyncpg\\protocol\\protocol.pyx", line 368, in asyncpg.protocol.protocol.BaseProtocol.query
  File "asyncpg\\protocol\\coreproto.pyx", line 1174, in asyncpg.protocol.protocol.CoreProtocol._simple_query
  File "asyncpg\\protocol\\protocol.pyx", line 967, in asyncpg.protocol.protocol.BaseProtocol._write
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 366, in write
    self._loop_writing(data=bytes(data))
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\proactor_events.py", line 402, in _loop_writing
    self._write_fut = self._loop._proactor.send(self._sock, data)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'send'

During handling of the above exception, another exception occurred:
E   AttributeError: 'NoneType' object has no attribute 'send'
---------------------------- Captured stderr setup ----------------------------
{"timestamp": "2025-11-07T06:39:18.280733Z", "level": "ERROR", "logger": "sqlalchemy.pool.impl.AsyncAdaptedQueuePool", "message": "Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F425BA6C0>>", "module": "base", "function": "_close_connection", "line": 376, "exception": "Traceback (most recent call last):\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\pool\\base.py\", line 372, in _close_connection\n    self._dialect.do_terminate(connection)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 1127, in do_terminate\n    dbapi_connection.terminate()\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\connectors\\asyncio.py\", line 402, in terminate\n    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501\n    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 132, in await_only\n    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\util\\_concurrency_py3k.py\", line 196, in greenlet_spawn\n    value = await result\n            ^^^^^^^^^^^^\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\sqlalchemy\\dialects\\postgresql\\asyncpg.py\", line 912, in _terminate_graceful_close\n    await self._connection.close(timeout=2)\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1504, in close\n    await self._protocol.close(timeout)\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 627, in close\n  File \"asyncpg\\\\protocol\\\\protocol.pyx\", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel\n  File \"D:\\Project\\Running\\VideTrading\\Vibex\\backend\\.venv\\Lib\\site-packages\\asyncpg\\connection.py\", line 1673, in _cancel_current_command\n    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))\n                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 455, in create_task\n    self._check_closed()\n  File \"C:\\Users\\erwin\\AppData\\Roaming\\uv\\python\\cpython-3.12.11-windows-x86_64-none\\Lib\\asyncio\\base_events.py\", line 545, in _check_closed\n    raise RuntimeError('Event loop is closed')\nRuntimeError: Event loop is closed"}
{"timestamp": "2025-11-07T06:39:18.286196Z", "level": "ERROR", "logger": "app.db.session", "message": "Database session error: 'NoneType' object has no attribute 'send'", "module": "session", "function": "get_db", "line": 124}
----------------------------- Captured log setup ------------------------------
ERROR    sqlalchemy.pool.impl.AsyncAdaptedQueuePool:base.py:376 Exception terminating connection <AdaptedConnection <asyncpg.connection.Connection object at 0x0000023F425BA6C0>>
Traceback (most recent call last):
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 372, in _close_connection
    self._dialect.do_terminate(connection)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 1127, in do_terminate
    dbapi_connection.terminate()
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\connectors\asyncio.py", line 402, in terminate
    self.await_(asyncio.shield(self._terminate_graceful_close()))  # type: ignore[attr-defined] # noqa: E501
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\dialects\postgresql\asyncpg.py", line 912, in _terminate_graceful_close
    await self._connection.close(timeout=2)
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1504, in close
    await self._protocol.close(timeout)
  File "asyncpg\\protocol\\protocol.pyx", line 627, in close
  File "asyncpg\\protocol\\protocol.pyx", line 660, in asyncpg.protocol.protocol.BaseProtocol._request_cancel
  File "D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\asyncpg\connection.py", line 1673, in _cancel_current_command
    self._cancellations.add(self._loop.create_task(self._cancel(waiter)))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 455, in create_task
    self._check_closed()
  File "C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\asyncio\base_events.py", line 545, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
ERROR    app.db.session:session.py:124 Database session error: 'NoneType' object has no attribute 'send'
================================== FAILURES ===================================
D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py:266: assert 200 == 401
D:\Project\Running\VideTrading\Vibex\backend\tests\e2e\test_decision_generate_api_e2e.py:285: assert 200 in [401, 403]
============================== warnings summary ===============================
tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_valid_request_all_fields
  C:\Users\erwin\AppData\Roaming\uv\python\cpython-3.12.11-windows-x86_64-none\Lib\threading.py:277: RuntimeWarning: coroutine 'Connection._cancel' was never awaited
    def __init__(self, lock=None):
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_force_refresh
  D:\Project\Running\VideTrading\Vibex\backend\.venv\Lib\site-packages\sqlalchemy\orm\loading.py:812: RuntimeWarning: coroutine 'Connection._cancel' was never awaited
    def _instance_processor(
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
ERROR tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_valid_request_minimal_fields
ERROR tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_missing_required_fields
ERROR tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_generate_decision_btc
ERROR tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_strategy_override
ERROR tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_rate_limit_exceeded
ERROR tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_internal_server_error
ERROR tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_decision_object_validation
FAILED tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_missing_authentication_token
FAILED tests/e2e/test_decision_generate_api_e2e.py::TestDecisionGenerateAPIWithAuth::test_invalid_jwt_token
============== 2 failed, 8 passed, 2 warnings, 7 errors in 0.87s ==============
